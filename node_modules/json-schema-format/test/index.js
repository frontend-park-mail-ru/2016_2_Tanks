var Assert = require( 'assert' );
var Format = require( '../src/index' );

describe( 'json-schema-format', function(){

    describe( 'format测试', function(){
        it( 'data-time', function( done ){
            Assert.equal( Format( 'data-time', '2002-11-26T00:03:44.32Z' ), true );
            Assert.equal( Format( 'data-time', '14768976543' ), false );
            done();
        });

        it( 'email', function( done ){
            Assert.equal( Format( 'email', 'yinruo.nyj@taobao.com' ), true );
            done();
        });

        it( 'hostname', function( done ){
            Assert.equal( Format( 'hostname', 'www.taobao.com' ), true );
            done();
        });

        it( 'ipv4', function( done ){
            Assert.equal( Format( 'ipv4', '255.256.23.0' ), false );
            Assert.equal( Format( 'ipv4', '255.250.23.0.10' ), false );
            Assert.equal( Format( 'ipv4', '255.255.23.0' ), true );
            done();
        });

        it( 'ipv6', function( done ){
            Assert.equal( Format( 'ipv6', 'FE80:0000:0000:0000:AAAA:0000:00C2:0002' ), true );
            Assert.equal( Format( 'ipv6', '2001:0DB8:0000:0000:0000::1428:0000' ), true );
            done();
        });

        it( 'uri', function( done ){
            Assert.equal( Format( 'uri', 'http://taobao.com' ), true );
            Assert.equal( Format( 'uri', 'mailto:xxx@xxx.xx' ), true );
            done();
        });

        it( 'TIMESTAMP', function( done ){
            Assert.equal( Format( 'TIMESTAMP', Date.now() ), true );
            done();
        });

        it( 'DATE_TIME', function( done ){
            Assert.equal( Format( 'DATE_TIME', '2014-12-13 6:55:30' ), true );
            done();
        });

        it( 'URL', function( done ){
            Assert.equal( Format( 'URL', 'http://dip.taobao.net' ), true );
            done();
        });

        it( 'TMALL_DETAIL', function( done ){
            Assert.equal( Format( 'TMALL_DETAIL', 'http://detail.tmall.com/item.htm?spm=p531232234.1.w5003-6316546454.14.ZkNgbh&id=36628862613&mt=&scene=taobao_shop' ), true );
            done();
        });

        it( 'TAOBAO_DETAIL', function( done ){
            Assert.equal( Format( 'TAOBAO_DETAIL', 'http://item.taobao.com/item.htm?id=12207706039' ), true );
            done();
        });

        it( 'TMALL_SHOP', function( done ){
            Assert.equal( Format( 'TMALL_SHOP', 'http://apple.tmall.com/?spm=a220m.1000858.0.0.WQWrOZ&rn=9c944e8a181e14bcc9185e42b7eb2d78' ), true );
            done();
        });

        it( 'TAOBAO_SHOP', function( done ){
            Assert.equal( Format( 'TAOBAO_SHOP', 'http://shop33516002.taobao.com/?spm=a230r.7195193.1997079397.22.sEn3Mx&v=1' ), true );
            done();
        });

        it( 'CDN_PIC', function( done ){
            Assert.equal( Format( 'CDN_PIC', 'http://img01.taobaocdn.com/bao/uploaded/i1/T1eE0oFyBsXXXy1_P2-941-415.jpg_160x160.jpg' ), true );
            Assert.equal( Format( 'CDN_PIC', 'http://gtms04.alicdn.com/tps/i4/T1MLwaFNFXXXci.CTm-97-105.png' ), true );
            Assert.equal( Format( 'CDN_PIC', 'http://img04.taobaocdn.com/bao/uploaded/i4/i1/T1EecdXmReXXbJfNIV_020723.jpg_250x250.jpg_.webp' ), true );
            done();
        });
    });

    describe( '添加到tv4中测试', function(){

        var TV4 = require( 'tv4' );

        it( 'test for URL', function( done ){

            var schema = {
                type: 'object',
                properties: {
                    url: {
                        type: 'string',
                        format: 'URL'
                    },
                    pic: {
                        type: 'string',
                        format: 'CDN_PIC'
                    }
                }
            };

            var retForURL = TV4.validate( {
                url: 'http://pan.taobao.com'
            }, schema );

            var retForCDNPic = TV4.validate( {
                pic: 'http://pan.taobao.com'
            }, schema );

            Assert.equal( retForURL, true );
            Assert.equal( retForCDNPic, false );

            done();
        });


    });

});