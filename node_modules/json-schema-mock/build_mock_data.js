/**
 * 该文件用于构造模拟数据
 */
var FS = require( 'fs' );

console.log( '开始读取商品数据' );
// 读取商品数据
var MOCK_PATH = './MOCK_DATA/matrix_items';
var MOCK_ITEMS = [];

// 读取 MOCK_DATA 目录下的所有文件
var mockDir = FS.readdirSync( MOCK_PATH );
mockDir.forEach( function( path ){

    var data = require( MOCK_PATH + '/' + path );
    if( data.results && data.results.length ){
        MOCK_ITEMS = MOCK_ITEMS.concat( data.results );
    }
});

console.log( '共读取到商品数据 ' + MOCK_ITEMS.length + ' 个' );


build_cdn_pic();


/**
 * 构造CDN图片
 */
function build_cdn_pic (){

    console.log( '开始构建CDN图片数据' );

    var cdnMockPath =  './MOCK_DATA/cdn_pics.json';
    var pics = [];

    MOCK_ITEMS.forEach(function( item ){
        if( item.allPictures && item.allPictures.length ){
            item.allPictures.forEach(function( pic ){
                pics.push( pic.value );
            });
        }
    });

    console.log( '共读取到图片' + pics.length + ' 个' );
    console.log( '写入文件: ' + cdnMockPath );

    FS.writeFileSync( cdnMockPath, JSON.stringify( pics ) );
}